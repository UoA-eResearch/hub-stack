<!-- If we're displaying a collection of software  -->
<app-collection-list 
    *ngIf="allSoftware$ | async as allSoftware" 
    [collection]="allSoftware">
</app-collection-list>

<!-- If we're displaying an individual software -->
<div 
    id="software-container"
    ngClass.xs="mobile"
    ngClass.sm="mobile"
    *ngIf="software$ | async as software">

    <!-- Templates -->
    <ng-template #dynamicBanner>
        <div 
            class="banner-container"
            [style]="software.banner ? 'background: url(' + software.banner.url + ') no-repeat' : ''">
        </div>  
    </ng-template>

    <ng-template #breadcrumbs>
        <div 
            id="breadcrumbs" 
            class="section"
            *ngIf="!!parentSubHubs" 
            ngClass.xs="breadcrumbs-mobile">
            <span 
                class="breadcrumb-subhub" 
                *ngFor="let subHub of parentSubHubs.slice().reverse()">
                <a [routerLink]="'/subhub/' + subHub.slug">
                    {{ subHub.title }}
                </a>
            </span>
            <span id="breadcrumb-current-page">
                {{ software.title }}
            </span>
        </div>
    </ng-template>

    <ng-template #title>
        <div>
            <span>
                <div 
                    class="software-title"
                    ngClass.xs="software-title-xs">
                    {{ software.title }}
                </div>
                <div 
                    class="software-summary"
                    ngClass.xs="software-summary-xs">
                    {{ software.summary }}
                </div>
            </span>
                <a href="{{ software.callToAction }}">
                    <button class="standard-button section" mat-flat-button>
                        <b>Software Details</b>
                    </button>
                </a>
            <div class="section">
                <hr/>
            </div>
        </div>
    </ng-template>

    <ng-template #relatedItems>
        <div 
            *ngIf="software.relatedItemsCollection.items.length > 0" 
            id="you-might-be-interested-in">
            <h4>You might also be interested in<hr/></h4>

            <mat-nav-list 
                style="margin-bottom: 2.2vh;" 
                *ngFor="let relatedItem of software.relatedItemsCollection.items" 
                class="collection">
                
                    <a [routerLink]="['/', relatedItem['__typename'].toLowerCase(), relatedItem['slug']]">
                        <mat-card>
                            <span class="card-title">
                                {{ relatedItem['title'] }}
                            </span> 
                            <br/>
                            <span class="card-summary">
                                {{ relatedItem['summary'] }}
                            </span>
                        </mat-card>
                    </a>
            </mat-nav-list>
        </div>
    </ng-template>

    <ng-template #relatedContacts>
        <div 
            *ngIf="software.relatedContactsCollection.items.length > 0"
            class="software-owners">
            <h4>Contacts<hr/></h4>
            <mat-nav-list 
                style="margin-bottom: 2.2vh;" 
                *ngFor="let contact of software.relatedContactsCollection.items" 
                class="collection">
                    <mat-card>
                        <span class="card-title">
                            {{ contact['name'] }}
                        </span> 
                        <br/>
                        <span class="card-summary">
                            {{ contact['email'] }}
                        </span>
                    </mat-card>
            </mat-nav-list>
        </div>
    </ng-template>

    <ng-template #relatedOrganisations>
        <div 
            *ngIf="software.relatedOrgsCollection.items.length > 0" 
            class="column-header">
            <h4>Organisations</h4>
            <hr/>
            <mat-nav-list 
                style="margin-bottom: 2.2vh;" 
                *ngFor="let organisation of software.relatedOrgsCollection.items" 
                class="collection">
                
                    <a [routerLink]="">
                        <mat-card>
                            <span class="card-title">
                                {{ organisation.unitName }}
                            </span> 
                            <br/>
                            <span class="card-summary">
                                {{ organisation.summary }}
                            </span>
                        </mat-card>
                    </a>
            </mat-nav-list>
        </div>
    </ng-template>

    <ng-template #publisherAndOwner>
        <div 
            *ngIf="software.publisher || software.owner"
            class="software-owners"
            fxLayout="row wrap"
            fxLayout.xs="column wrap"
            fxLayoutGap="5%">
            <div fxFlex>
                <mat-card>
                    <span class="card-title">
                        {{ software.publisher.name }}
                    </span> 
                    <br/>
                    <span class="card-summary">
                        {{ software.owner.email }}
                    </span>
                </mat-card>
            </div>
            <div fxFlex>
                <mat-card>
                    <span class="card-title">
                        {{ software.owner.name }}
                    </span> 
                    <br/>
                    <span class="card-summary">
                        {{ software.owner.email }}
                    </span>
                </mat-card>
            </div>
        </div>
    </ng-template>

    <ng-template #description>
        <div>
            <div [innerHTML]="software.bodyText.json | richTextToHTML">
            </div>
        </div>
    </ng-template>

    <!-- Software Content -->
    <ng-container *ngTemplateOutlet="dynamicBanner"></ng-container>
    <div
        class="site-padding-2 top-padding margin-bottom"
        ngClass.xs="site-padding-sm top-padding margin-bottom"
        ngClass.sm="site-padding-sm top-padding margin-bottom">
        <ng-container *ngTemplateOutlet="breadcrumbs"></ng-container>
        <ng-container *ngTemplateOutlet="title"></ng-container>
        <ng-container *ngTemplateOutlet="publisherAndOwner"></ng-container>
        <ng-container *ngTemplateOutlet="description"></ng-container>
        <ng-container *ngTemplateOutlet="relatedItems"></ng-container>
        <ng-container *ngTemplateOutlet="relatedContacts"></ng-container>
    </div>
</div>