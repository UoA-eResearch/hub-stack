<!-- If we're displaying a collection of articles-->
<div
    *ngIf="allArticles$ | async as allArticles" 
    class="site-padding margin-bottom top-padding" 
    ngClass.xs="site-padding-xs margin-bottom-xs top-padding" 
    ngClass.sm="site-padding-sm margin-bottom-sm top-padding">
    <app-collection-list [collection]="allArticles"></app-collection-list>
</div>


<!-- If we're displaying an individual article -->
<div 
    id="article-container" 
    *ngIf="article$ | async as article">

    <!-- Templates -->
    <ng-template #breadcrumbs>
        <app-breadcrumbs 
            [contentItem]="parentSubHubs" 
            [title]="article.title">
        </app-breadcrumbs>
    </ng-template>

    <ng-template #dynamicBanner>
        <div 
            class="banner-container"
            [style]="article.banner ? 'background: url(' + article.banner.url + ') no-repeat' : article.viewType == 'View 2' ? 'display: none;' : ''">
        </div>  
    </ng-template>

    <ng-template #titleSummary>
        <h1 
            class="content-title" 
            ngClass.sm="content-title-sm" 
            ngClass.xs="content-title-xs" 
            [style.color]="article.banner ? article.viewType == 'View 1' ? 'white' : '' : ''">
            {{ article.title }}
        </h1>

        <h3 
            class="content-summary" 
            ngClass.sm="content-summary-sm" 
            ngClass.xs="content-summary-xs"
            [style.color]="article.banner ? article.viewType == 'View 1' ? 'white' : '' : ''">
            {{ article.summary }}
        </h3>
    </ng-template>

    <ng-template #articleBody>
        <ngx-contentful-rich-text
            class="section-2"
            style="word-break:break-word;" 
            [document]="article.bodyText.json"
            [nodeRenderers]="nodeRenderers">
        </ngx-contentful-rich-text>
    </ng-template>

    <ng-template #relatedItems let-hide="hideImage">
        <app-cards 
            id="you-might-be-interested-in"
            [hideImage]="hide"
            [title]="'You might also be interested in'" 
            [contentItem]="article.relatedItemsCollection">
        </app-cards>
    </ng-template>

    <ng-template #relatedOrganisations let-hide="hideImage">
        <app-cards 
            [hideImage]="hide"
            [title]="'Organisations'" 
            [contentItem]="article.relatedOrgsCollection">
        </app-cards>
    </ng-template>
    
    <ng-template #relatedContacts let-hide="hideImage">
        <app-cards 
            [hideImage]="hide"
            [title]="'Contacts'" 
            [contentItem]="article.relatedContactsCollection">
        </app-cards>
    </ng-template>

    <ng-template #officialDocuments let-hide="hideImage">
        <app-cards 
            [hideImage]="hide"
            [title]="'Documents'" 
            [contentItem]="article.relatedDocsCollection">
        </app-cards>
    </ng-template>

    <ng-template #keywords>
        <app-keywords 
            id="keywords" 
            [contentItem]="article.keywords">
        </app-keywords>
    </ng-template>
    
    
    <!-- View Switcher -->
    <div [ngSwitch]="article.viewType"> 

        <!-- View 1 -->
        <div *ngSwitchCase="'View 1'">

            <!-- Dynamic Banner -->
            <div 
                class="banner-container"
                [style]="article.banner ? 'background: url(' + article.banner.url + ') no-repeat' : article.viewType == 'View 2' ? 'display: none;' : 'min-height: 0px'">
                <div 
                    class="banner-content" 
                    [style]="article.banner ?  '' : 'margin: 3vh 0;'"
                    *ngIf="article.viewType == 'View 1'">
                    <ng-container *ngTemplateOutlet="titleSummary"></ng-container>
                </div>
            </div> 

            <!-- Breadcrumbs -->
            <ng-container *ngTemplateOutlet="breadcrumbs"></ng-container>

            <div 
                class="site-padding top-padding" 
                ngClass.xs="site-padding-xs top-padding" 
                ngClass.sm="site-padding-sm top-padding"
                fxLayout="row wrap" 
                fxLayout.sm="column wrap"
                fxLayout.xs="column wrap"   
                fxLayoutGap="5%">

                <!-- Article Body -->
                <div 
                    fxFlex
                    fxFlexOrder="2"
                    fxFlexOrder.xs="1">

                    <ng-container *ngTemplateOutlet="articleBody"></ng-container>

                    <!-- Keywords -->
                    <ng-container *ngTemplateOutlet="keywords"></ng-container>

                </div>

                <!-- Extra Links -->
                <div 
                    *ngIf="
                        article.relatedDocsCollection.items.length > 0 ||
                        article.relatedContactsCollection.items.length > 0 ||
                        article.relatedOrgsCollection.items.length > 0 "
                    fxLayout="column" 
                    fxFlex="20%"
                    fxFlexOrder="1"
                    fxFlexOrder.lt-sm="2">

                    <!-- Official Documents -->
                    <ng-container *ngTemplateOutlet="officialDocuments"></ng-container>

                    <!-- Contacts -->
                    <ng-container *ngTemplateOutlet="relatedContacts"></ng-container>

                    <!-- Organizations -->
                    <ng-container *ngTemplateOutlet="relatedOrganisations"></ng-container>

                </div>

                <!-- Related items -->
                <div 
                    id="you-might-be-interested-in"
                    fxLayout="column" 
                    fxFlex="20%"
                    fxFlexOrder="3">
                    <ng-container *ngTemplateOutlet="relatedItems"></ng-container>
                </div>
            </div>
        </div>

        <!-- View 2 -->
        <div *ngSwitchCase="'View 2'">

            <!-- Dynamic Banner -->
            <ng-container *ngTemplateOutlet="dynamicBanner"></ng-container>

            <!-- Breadcrumbs -->
            <ng-container *ngTemplateOutlet="breadcrumbs"></ng-container>

            <div 
                class="site-padding top-padding" 
                ngClass.xs="site-padding-xs top-padding" 
                ngClass.sm="site-padding-sm top-padding"
                fxLayout="row wrap" 
                fxLayout.sm="column wrap"
                fxLayout.xs="column wrap"   
                fxLayoutAlign="space-between"
                fxLayoutGap="5%">

                <!-- Article Title and Summary -->
                    <div fxFlex>
                        <ng-container *ngTemplateOutlet="titleSummary"></ng-container>

                        <hr/>

                        <!-- Article Body -->
                        <ng-container *ngTemplateOutlet="articleBody"></ng-container>

                    </div>

                    <!-- Extra Links -->
                    <div 
                        fxLayout="column" 
                        fxFlex="25%">

                        <!-- Official Documents -->
                        <ng-container *ngTemplateOutlet="officialDocuments"></ng-container><div><br/></div>

                        <!-- Contacts -->
                        <ng-container *ngTemplateOutlet="relatedContacts"></ng-container><div><br/></div>

                        <!-- Organizations -->
                        <ng-container *ngTemplateOutlet="relatedOrganisations"></ng-container><div><br/></div>

                        <!-- Related Items -->
                        <div id="you-might-be-interested-in">
                            <ng-container *ngTemplateOutlet="relatedItems"></ng-container><div><br/></div>
                        </div>

                        <!-- Keywords -->
                        <ng-container *ngTemplateOutlet="keywords"></ng-container>
                    </div>
            </div>
        </div>
    </div>
    <!-- End of View Switcher -->
    <div class="section"></div>
</div>
