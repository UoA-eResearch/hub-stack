<!-- If we're displaying a collection of articles-->
<app-collection-list 
    *ngIf="allArticles$ | async as allArticles" 
    [collection]="allArticles">
</app-collection-list>


<!-- If we're displaying an individual article -->
<div 
    id="article-container" 
    *ngIf="article$ | async as article">

    <!-- Templates -->
    <ng-template #dynamicBanner>
        <div 
            class="banner-container"
            [style]="article.banner ? 'background: url(' + article.banner.url + ') no-repeat' : article.viewType == 'View 2' ? 'display: none;' : ''">
        </div>  
    </ng-template>

    <ng-template #breadcrumbs>
        <div 
            id="breadcrumbs" 
            *ngIf="!!parentSubHubs"
            ngClass.lt-md="breadcrumbs-mobile">
            <span 
                class="breadcrumb-subhub" 
                *ngFor="let subHub of parentSubHubs.slice().reverse()">
                <a [routerLink]="'/subhub/' + subHub.slug">
                    {{ subHub.title }}
                </a>
            </span>
            <span id="breadcrumb-current-page">
                {{ article.title }}
            </span>
        </div>
    </ng-template>

    <ng-template #titleSummary>
        <h1 
            class="content-title" 
            ngClass.lt-md="content-title-mobile" 
            [style.color]="article.banner ? article.viewType == 'View 1' ? 'white' : '' : ''">
            {{ article.title }}
        </h1>

        <h3 
            class="content-summary" 
            ngClass.lt-md="content-summary-mobile"
            [style.color]="article.banner ? article.viewType == 'View 1' ? 'white' : '' : ''">
            {{ article.summary }}
        </h3>
    </ng-template>

    <ng-template #articleBody>
        <div 
            [innerHTML]="article.bodyText.json | richTextToHTML">
        </div>
    </ng-template>

    <ng-template #relatedOrganisations>
        <div 
            *ngIf="article.relatedOrgsCollection.items.length > 0" 
            class="column-header">
            <h4>Organisations</h4>
            <mat-nav-list 
                *ngFor="let organisation of article.relatedOrgsCollection.items" 
                class="collection">
                    <a [routerLink]="">
                        <mat-card>
                            <span class="card-title">
                                {{ organisation.unitName }}
                            </span> 
                            <br/>
                            <span class="related-item-summary">
                                {{ organisation.summary }}
                            </span>
                        </mat-card>
                    </a>
            </mat-nav-list>
        </div>
    </ng-template>

    <ng-template #relatedContacts>
        <div 
            *ngIf="article.relatedContactsCollection.items.length > 0" 
            class="column-header">
            <h4>Contacts</h4>
            <mat-nav-list 
                style="margin-bottom: 20px;" 
                *ngFor="let contact of article.relatedContactsCollection.items" 
                class="collection">
                
                    <a [routerLink]="">
                        <mat-card>
                            <span class="card-title">
                                {{ contact['name'] }}
                            </span> 
                            <br/>
                            <span class="related-item-summary">
                                {{ contact['jobTitle'] }}
                            </span>
                        </mat-card>
                    </a>
            </mat-nav-list>
        </div>
    </ng-template>

    <ng-template #relatedItems>
        <div 
            *ngIf="article.relatedItemsCollection.items.length > 0" 
            id="you-might-be-interested-in">
            <h4>You might also be interested in</h4>
            <mat-nav-list 
                style="margin-bottom: 20px;" 
                *ngFor="let relatedItem of article.relatedItemsCollection.items" 
                class="collection">
                
                    <a [routerLink]="['/', relatedItem['__typename'].toLowerCase(), relatedItem['slug']]">
                        <mat-card>
                            <span class="card-title">
                                {{ relatedItem['title'] }}
                            </span> 
                            <br/>
                            <span class="card-summary">
                                {{ relatedItem['summary'] }}
                            </span>
                        </mat-card>
                    </a>
            </mat-nav-list>
        </div>
    </ng-template>

    <ng-template #officialDocuments>
        <div 
            *ngIf="article.relatedDocsCollection.items.length > 0">
            <h4>Official Documents</h4>
            <mat-nav-list  
                *ngFor="let document of article.relatedDocsCollection.items" 
                class="collection">
                
                    <a href={{document.url}} target="_blank">
                        <mat-card>
                            <span class="card-title">
                                {{ document['title'] }}
                            </span> 
                            <br/>
                            <span class="card-summary">
                                {{ document['summary'] }}
                            </span>
                        </mat-card>
                    </a>
            </mat-nav-list>
        </div>
    </ng-template>
    
    
    <!-- View Switcher -->
    <div [ngSwitch]="article.viewType"> 

        <!-- View 1 -->
        <div *ngSwitchCase="'View 1'">

            <!-- Dynamic Banner -->
            <div 
                class="banner-container"
                [style]="article.banner ? 'background: url(' + article.banner.url + ') no-repeat' : article.viewType == 'View 2' ? 'display: none;' : 'min-height: 0px'">
                <div 
                    class="banner-content" 
                    [style]="article.banner ? '' : 'margin: 2.5em auto;'"
                    *ngIf="article.viewType == 'View 1'">
                    <ng-container *ngTemplateOutlet="titleSummary"></ng-container>
                </div>
            </div> 

            <div 
                class="site-padding top-padding margin-bottom" 
                ngClass.lt-md="site-padding-mobile top-padding margin-bottom">

                <!-- Breadcrumbs -->
                <ng-container *ngTemplateOutlet="breadcrumbs"></ng-container>

                <div 
                    fxLayout.lt-sm="column wrap"
                    fxLayout="row wrap" 
                    fxLayoutGap="5%">

                    <!-- Call to Actions -->
                    <div 
                        fxFlex
                        fxFlexOrder="2"
                        fxFlexOrder.xs="1">

                        <!-- Article Body -->
                        <ng-container *ngTemplateOutlet="articleBody"></ng-container>
                    </div>

                    <!-- Extra Links -->
                    <div 
                        fxLayout="column" 
                        fxFlex="20%"
                        fxFlexOrder="1"
                        fxFlexOrder.lt-sm="2">

                        <!-- Official Documents -->
                        <ng-container *ngTemplateOutlet="officialDocuments"></ng-container>

                        <!-- Contacts -->
                        <ng-container *ngTemplateOutlet="relatedContacts"></ng-container>

                        <!-- Organizations -->
                        <ng-container *ngTemplateOutlet="relatedOrganisations"></ng-container>

                    </div>

                    <!-- Related items -->
                    <div 
                        fxLayout="column" 
                        fxFlex="20%"
                        fxFlexOrder="3">
                        <ng-container *ngTemplateOutlet="relatedItems"></ng-container>
                    </div>    
                </div>
            </div>
        </div>

        <!-- View 2 -->
        <div *ngSwitchCase="'View 2'">

            <!-- Dynamic Banner -->
            <ng-container *ngTemplateOutlet="dynamicBanner"></ng-container>

            <div 
                class="site-padding"
                ngClass.lt-md="site-padding-mobile"
                fxLayout="row wrap" 
                fxLayout.lt-sm="column wrap"  
                fxLayoutAlign="space-between"
                fxLayoutGap="5%">

                <!-- Breadcrumbs -->
                <ng-container *ngTemplateOutlet="breadcrumbs"></ng-container>

                <!-- Article Title and Summary -->
                <div fxFlex>
                    <ng-container *ngTemplateOutlet="titleSummary"></ng-container>

                    <hr />

                    <!-- Article Body -->
                    <ng-container *ngTemplateOutlet="articleBody"></ng-container>

                </div>

                <!-- Extra Links -->
                <div 
                    fxLayout="column" 
                    fxFlex="25%">

                    <!-- Official Documents -->
                    <ng-container *ngTemplateOutlet="officialDocuments"></ng-container><div><br/></div>

                    <!-- Contacts -->
                    <ng-container *ngTemplateOutlet="relatedContacts"></ng-container><div><br/></div>

                    <!-- Organizations -->
                    <ng-container *ngTemplateOutlet="relatedOrganisations"></ng-container><div><br/></div>

                    <!-- Related Items -->
                    <ng-container *ngTemplateOutlet="relatedItems"></ng-container><div><br/></div>
                </div>
            </div>
        </div>
    </div>

    <!-- End of View Switcher -->
</div>
