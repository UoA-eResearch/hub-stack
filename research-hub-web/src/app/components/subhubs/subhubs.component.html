<!-- If we're displaying a collection of SubHubs-->
<div
  *ngIf="allSubHubs$ | async as allSubHubs"
  class="site-padding margin-bottom top-padding"
  ngClass.lt-md="site-padding-mobile margin-bottom top-padding"
>
  <app-collection-list [collection]="allSubHubs"></app-collection-list>
</div>

<div
  style="overflow-x: hidden"
  class="results"
  *ngIf="subHub | async as subHub"
>
  <div id="subhub-container">
    <div
      class="banner-container"
      [ngClass]="
        bannerImageUrl === undefined
          ? ''
          : isMobile
          ? 'mobile-banner'
          : 'standard-banner'
      "
      [ngStyle]="
        bannerImageUrl && {
          'background-image': 'url(' + bannerImageUrl + ')'
        }
      "
    >
      <div class="banner-content">
        <!-- Title -->
        <h1
          role="heading"
          aria-level="1"
          class="content-title"
          ngClass.lt-md="content-title-mobile"
          [style]="subHub.banner ? bannerTextStyling : ''"
        >
          {{ subHub.title }}
        </h1>

        <!-- Maori Proverb -->
        <h2
          aria-level="2"
          *ngIf="subHub.maoriProverb"
          class="maori-proverb"
          [style]="subHub.banner ? bannerTextStyling : ''"
        >
          <hr />
          {{ subHub.maoriProverb }}
          <hr />
        </h2>

        <!-- Summary -->
        <p
          class="content-summary"
          ngClass.sm="content-summary-sm"
          ngClass.xs="content-summary-xs"
          [style]="subHub.banner ? bannerTextStyling : ''"
        >
          <small>{{ subHub.summary }}</small>
        </p>
      </div>
    </div>

    <div class="site-padding" ngClass.lt-md="site-padding-mobile">
      <app-breadcrumbs
        [contentItem]="parentSubHubs"
        [title]="subHub.title"
      ></app-breadcrumbs>

      <!-- Body Content -->
      <div
        fxLayout="row wrap"
        fxLayout.lt-sm="column wrap"
        fxLayoutGap="2%"
        fxLayoutAlign="space-between"
      >
        <!-- Main Body -->
        <div fxFlex class="section">
          <ng-container
            *ngTemplateOutlet="body; context: { $implicit: subHub }"
          ></ng-container>
        </div>
      </div>
    </div>

    <!-- SubHub Children -->
    <div
      *ngIf="
        subHub.internalPagesCollection.items.length > 0 ||
        subHub.externalPagesCollection.items.length > 0
      "
      fxLayout="row wrap"
      fxLayout.xs="column"
      fxLayoutGap="25px"
      class="site-padding"
      ngClass.lt-md="site-padding-mobile"
    >
      <app-standard-card
        *ngFor="let child of subHub.internalPagesCollection.items"
        [contentItem]="child"
        [isSubhubChild]="true"
      ></app-standard-card>
    </div>

    <!-- Extra Links -->
    <div
      class="site-padding"
      ngClass.lt-md="site-padding-mobile"
      *ngIf="
        subHub.relatedDocsCollection.items.length > 0 ||
        subHub.relatedContactsCollection.items.length > 0 ||
        subHub.relatedOrgsCollection.items.length > 0 ||
        subHub.relatedItemsCollection.items.length > 0
      "
      fxLayout="column"
    >
      <h3>
        Explore Related
        <hr />
      </h3>
      <div fxLayout="row wrap" fxLayout.xs="column" fxLayoutGap="25px">
        <app-standard-card
          id="you-might-be-interested-in"
          *ngFor="let content of subHub.relatedItemsCollection.items"
          [contentItem]="content"
        ></app-standard-card>
      </div>

      <h3 *ngIf="subHub?.relatedContactsCollection.items.length > 0">
        Contacts
        <hr />
      </h3>
      <div fxLayout="row wrap" fxLayout.xs="column" fxLayoutGap="25px">
        <app-contact-card
          *ngFor="let person of subHub.relatedContactsCollection.items"
          [person]="person"
        ></app-contact-card>
      </div>

      <h3 *ngIf="subHub?.relatedOrgsCollection.items.length > 0">
        Organisations
        <hr />
      </h3>
      <div fxLayout="row wrap" fxLayout.xs="column" fxLayoutGap="25px">
        <app-org-unit-card
          *ngFor="let orgUnit of subHub.relatedOrgsCollection.items"
          [orgUnit]="orgUnit"
        ></app-org-unit-card>
      </div>

      <h3 *ngIf="subHub?.relatedDocsCollection.items.length > 0">
        Documents
        <hr />
      </h3>
      <div fxLayout="row wrap" fxLayout.xs="column" fxLayoutGap="25px">
        <app-document-card
          *ngFor="let document of subHub.relatedDocsCollection.items"
          [document]="document"
        ></app-document-card>
      </div>
    </div>
  </div>
</div>

<!-- Templates -->
<ng-template #body let-subHub>
  <ngx-contentful-rich-text
    id="bodyMediaList"
    class="section-2"
    style="word-break: break-word"
    [document]="subHub.bodyText.json"
    [nodeRenderers]="nodeRenderers"
  ></ngx-contentful-rich-text>
</ng-template>
