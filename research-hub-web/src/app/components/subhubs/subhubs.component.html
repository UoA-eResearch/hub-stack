<!-- Displaying all SubHubs -->
<div
    *ngIf="allSubHubs$ | async as allSubHubs" 
    class="site-padding margin-bottom top-padding" 
    ngClass.xs="site-padding-xs margin-bottom-xs top-padding" 
    ngClass.sm="site-padding-sm margin-bottom-sm top-padding">
    <app-collection-list [collection]="allSubHubs"></app-collection-list>
</div>

<!-- Displaying an individual SubHub -->
<div 
    style="overflow-x: hidden"
    class="results" 
    *ngIf="currentSubHub$ | async as subhub">
    <div>
        
        <!-- Templates -->
        <ng-template #subHubChildren>
            <div 
                id="subhub-children"
                class="site-padding top-padding"
                ngClass.sm="site-padding-sm top-padding"
                ngClass.xs="site-padding-xs top-padding">
                <div
                    fxLayout="row wrap"
                    fxLayoutGap="1%"
                    fxLayout.sm="column wrap"
                    fxLayout.xs="column wrap">
                    <div
                        fxFlex="24%"
                        *ngFor="let subHub of subhub.subhubPagesCollection.items">
                        <mat-card class="subhub-card">
                            <img *ngIf="subHub.__typename == 'SubHub'" mat-card-image src="{{ subHub.banner.url }}" alt="{{subHub.title}}">
                            <img *ngIf="subHub.__typename != 'SubHub'" mat-card-image src="../../../assets/images/uoa-logo.svg" alt="{{subHub.title}}">
                            <mat-card-title class="card-title">
                                {{ subHub.title}}
                            </mat-card-title>
                            <mat-card-content class="related-item-summary">
                                {{ subHub.summary }}
                            </mat-card-content>
                            <mat-card-actions>
                                <a [routerLink]="'/' + subHub['__typename'].toLowerCase() + '/' + subHub['slug']">
                                    <button mat-stroked-button>READ MORE</button>
                                </a>
                            </mat-card-actions>
                        </mat-card>
                    </div>
                </div>
            </div>
        </ng-template>

        <ng-template #mediaCollection>
            <div 
                class="site-padding top-padding"
                ngClass.sm="site-padding-sm top-padding"
                ngClass.xs="site-padding-xs top-padding"
                *ngFor="let media of subhub.mediaCollection.items; let i = index">
                <div 
                    *ngIf="i % 2 == 0"
                    class="media-panel"
                    fxLayout="row wrap"
                    fxLayoutAlign="space-between"
                    fxLayoutGap="5%">
                    <img 
                        fxFlex="45%"
                        src="{{ media.url }}"/>
                    <span
                        fxFlex="45%"
                        fxLayout="column"
                        fxLayoutAlign="center">
                            <h4>{{ media.title }}</h4>
                            <p>{{ media.description }}</p>
                    </span>
                </div>

                <div 
                    *ngIf="i % 2 != 0"
                    class="media-panel"
                    fxLayout="row wrap"
                    fxLayoutAlign="space-between"
                    fxLayoutGap="5%">
                    <span
                        fxFlex="45%"
                        fxLayout="column"
                        fxLayoutAlign="center">
                            <h4>{{ media.title }}</h4>
                            <p>{{ media.description }}</p>
                    </span>
                    <img 
                        fxFlex="45%"
                        src="{{ media.url }}"/>
                </div>
            </div>
        </ng-template>

        <ng-template #relatedItems>
            <div 
                style="margin-bottom: 20px;"
                *ngIf="subhub.relatedItemsCollection.items.length > 0">
                <h4>Related Items<hr/></h4>
                <div 
                    [fxLayout]="subhub.viewType == 'View 1' ? 'column wrap' : 'row wrap'"
                    fxLayoutGap="1%"
                    fxLayout.sm="column wrap"
                    fxLayout.xs="column wrap">
                    <div *ngFor="let relatedItem of subhub.relatedItemsCollection.items">
                        <a [routerLink]="'/' + relatedItem['__typename'].toLowerCase() + '/' + relatedItem['slug']">
                            <mat-card >
                                <span class="card-title">
                                    {{ relatedItem.title}}
                                </span> 
                                <br/>
                                <span class="related-item-summary">
                                    {{ relatedItem.summary }}
                                </span>
                            </mat-card>
                        </a>
                    </div>
                </div>
            </div>
        </ng-template>

        <ng-template #keywords>
            <div *ngIf="subhub.keywords.length > 0">
                <h4>Keywords<hr/></h4>
                <mat-card-subtitle fxLayout="row wrap">
                    <span *ngFor="let keyword of subhub.keywords">
                        <mat-card 
                            fxLayout="row" 
                            class="keyword-card">
                                {{ keyword | humanCase }}
                        </mat-card>
                    </span>
                </mat-card-subtitle>
            </div>
        </ng-template>

        <ng-template #breadcrumbs>
            <div 
                id="breadcrumbs" 
                class="breadcrumbs top-padding"
                ngClass.sm="top-padding"
                ngClass.xs="top-padding"
                *ngIf="!!parentSubHubs">
                <span 
                    class="breadcrumb-subhub" 
                    *ngFor="let parentSubHub of parentSubHubs.slice().reverse()">
                    <a [routerLink]="'/subhub/' + parentSubHub.slug">
                        {{ parentSubHub.title }}
                    </a>
                </span>
                <span id="breadcrumb-current-page">
                    {{ subhub.title }}
                </span>
            </div>
        </ng-template>

        <ng-template #dynamicBanner>
            <div 
                class="banner-container"
                [style.background]="subhub.banner ? 'url(' + subhub.banner.url + ') no-repeat' : 'url(../../../assets/images/rsz_run-all-tests.jpg)'">
            </div>
        </ng-template>

        <!-- View 1 -->
        <div [ngSwitch]="subhub.viewType">
            <div *ngSwitchCase="'View 1'">
                <div 
                class="banner-container"
                [style.background]="subhub.banner ? 'url(' + subhub.banner.url + ') no-repeat' : 'url(../../../assets/images/rsz_run-all-tests.jpg)'">
                    <div
                        class="banner-content" 
                        *ngIf="subhub.viewType == 'View 1'">

                        <!-- Title and Summary for View 1 -->
                        <!-- Title -->
                        <h1 
                            class="subhub-title" 
                            ngClass.sm="subhub-title-sm" 
                            ngClass.xs="subhub-title-xs"
                            style="color: white;">
                                {{ subhub.title }}
                        </h1>

                        <!-- Summary -->
                        <h3 
                            class="subhub-summary" 
                            ngClass.sm="subhub-summary-sm" 
                            ngClass.xs="subhub-summary-xs"
                            style="color: white">
                                <small>{{ subhub.summary }}</small>
                        </h3>
                    </div>
                </div>
                <div
                    class="site-padding top-padding"
                    ngClass.sm="site-padding-sm top-padding"
                    ngClass.xs="site-padding-xs top-padding">
                    
                    <!-- Breadcrumbs -->
                    <ng-container *ngTemplateOutlet="breadcrumbs"></ng-container>

                    <!-- Body Content -->
                    <div 
                        fxLayout="row wrap"
                        fxLayout.sm="column wrap"
                        fxLayout.xs="column wrap"
                        fxLayoutGap="2%"
                        fxLayoutAlign="space-between">
                        
                        <!-- Main Body -->
                        <div fxFlex="65%">
                            <div 
                                class="main-body"
                                [innerHTML]="subhub.body.json | richTextToHTML">
                            </div>
                        </div>

                        <!-- Related Items and Keywords -->
                        <div fxFlex="30%">

                            <!-- Related Items -->
                            <ng-container *ngTemplateOutlet="relatedItems"></ng-container>

                            <!-- Keywords -->
                            <ng-container *ngTemplateOutlet="keywords"></ng-container>
                        </div>
                    </div>
                </div>

                <!-- SubHub Children -->
                <ng-container *ngTemplateOutlet="subHubChildren"></ng-container>

                <!-- Media Collection -->
                <ng-container *ngTemplateOutlet="mediaCollection"></ng-container>
            </div>

            <!-- View 2 -->
            <div *ngSwitchCase="'View 2'">
                <ng-container *ngTemplateOutlet="dynamicBanner"></ng-container>

                <div>

                    <!-- Breadcrumbs -->
                    <div 
                        class="site-padding"
                        ngClass.sm="site-padding-sm"
                        ngClass.xs="site-padding-xs">
                        <ng-container *ngTemplateOutlet="breadcrumbs"></ng-container>
                    </div>

                    <!-- Title and Summary -->
                    <div>
                        <h1
                            class="subhub-title site-padding" 
                            ngClass.sm="subhub-title-sm site-padding-sm" 
                            ngClass.xs="subhub-title-xs site-padding-xs">
                            {{ subhub.title }}
                        </h1>
                        <h3 
                            class="subhub-summary site-padding" 
                            ngClass.sm="subhub-summary-sm site-padding-sm" 
                            ngClass.xs="subhub-summary-xs site-padding-xs">
                            {{ subhub.summary }}
                            <hr style="margin: 25px 0px;"/>
                        </h3>
                    </div>
            
                    <!-- Body Content -->
                    <!-- Main Body -->
                    <div 
                        class="main-body site-padding"
                        ngClass.sm="site-padding-sm"
                        ngClass.xs="site-padding-xs"
                        [innerHTML]="subhub.body.json | richTextToHTML">
                    </div>
            
                    <!-- SubHub Children -->
                    <ng-container *ngTemplateOutlet="subHubChildren"></ng-container>

                    <!-- Media Collection -->
                    <ng-container *ngTemplateOutlet="mediaCollection"></ng-container>

                    <!-- Related Items -->
                    <div 
                        class="site-padding"
                        ngClass.sm="site-padding-sm"
                        ngClass.xs="site-padding-xs">
                        <ng-container *ngTemplateOutlet="relatedItems"></ng-container>
                    </div>

                    <!-- Keywords -->
                    <div
                        class="site-padding"
                        ngClass.sm="site-padding-sm"
                        ngClass.xs="site-padding-xs">
                        <ng-container *ngTemplateOutlet="keywords"></ng-container>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>