<!-- If we're displaying a collection of equipment -->
<div
    *ngIf="allEquipment$ | async as allEquipment" 
    class="site-padding margin-bottom top-padding" 
    ngClass.xs="site-padding-xs margin-bottom-xs top-padding" 
    ngClass.sm="site-padding-sm margin-bottom-sm top-padding">
    <app-collection-list [collection]="allEquipment"></app-collection-list>
</div>

<!-- If we're displaying an individual equipment -->
<div 
    id="equipment-container"
    *ngIf="equipment$ | async as equipment">

    <!-- Templates -->
    <ng-template #breadcrumbs>
        <app-breadcrumbs 
            [contentItem]="parentSubHubs" 
            [title]="equipment.title">
        </app-breadcrumbs>
    </ng-template>

    <ng-template #specificationsTable>
        <div 
            class="specifications section">
            <h4>Specifications</h4>
            <table class="specifications-table">
                <tr>
                <th>Name</th>
                <th>Description</th>
                </tr>
                <tr *ngIf="equipment.manufacturer">
                    <td>Manufacturer</td>
                    <td [innerHTML]="equipment.manufacturer"></td>
                </tr>
                <tr *ngIf="equipment.year">
                    <td>Year</td>
                    <td [innerHTML]="equipment.year"></td>
                </tr>
                <tr *ngIf="equipment.model">
                    <td>Model</td>
                    <td [innerHTML]="equipment.model"></td>
                </tr>
                <tr *ngIf="equipment.eligibility">
                    <td>Eligibility</td>
                    <td [innerHTML]="equipment.eligibility.json | richTextToHTML"></td>
                </tr>
                <tr *ngIf="equipment.costToUse">
                    <td>Cost</td>
                    <td [innerHTML]="equipment.costToUse.json | richTextToHTML"></td>
                </tr>
                <tr *ngIf="equipment.location">
                    <td>Location</td>
                    <td [innerHTML]="equipment.location.json | richTextToHTML"></td>
                </tr>
                <tr *ngIf="equipment.access">
                    <td>Access</td>
                    <td [innerHTML]="equipment.access.json | richTextToHTML"></td>
                </tr>
            </table>
        </div>
    </ng-template>
<<<<<<< HEAD
=======

    <ng-template #relatedItems>
        <div 
            *ngIf="equipment.relatedItemsCollection.items.length > 0" 
            id="you-might-be-interested-in">
            <h4>You might also be interested in<hr/></h4>

            <mat-nav-list 
                style="margin-bottom: 20px;" 
                *ngFor="let relatedItem of equipment.relatedItemsCollection.items" 
                class="collection">
                <mat-card>
                    <!-- TODO: Replace with array style [routerLink] (like in articles.component.html) -->
                    <a [routerLink]="'/' + relatedItem['__typename'].toLowerCase() + '/' + relatedItem['slug']">
                        {{ relatedItem['title'] }}<br/>
                    </a>
                    <span class="related-item-summary">
                        {{ relatedItem['summary'] }}
                    </span>
                </mat-card>
            </mat-nav-list>
        </div>
    </ng-template>
>>>>>>> 9f69b116196da784e0d6707fb9fe173108c9d23f
    
    <ng-template #relatedItems let-hide="hideImage">
        <app-cards 
            [hideImage]="hide"
            [title]="'You might be interested in'" 
            [contentItem]="equipment.relatedItemsCollection">
        </app-cards>
    </ng-template>

    <ng-template #relatedOrganisations>
        <app-cards 
            [title]="'Organisations'" 
            [contentItem]="equipment.relatedOrgsCollection">
        </app-cards>
    </ng-template>

    <ng-template #relatedFacilities>
        <app-cards 
            [title]="'Organisations'" 
            [contentItem]="equipment.relatedFacilityCollection">
        </app-cards>
    </ng-template>

    <ng-template #relatedContacts>
        <app-cards 
            [title]="'Contacts'" 
            [contentItem]="equipment.relatedContactsCollection">
        </app-cards>
    </ng-template>

    <ng-template #titleSummary>
        <h1 
            class="content-title" 
            ngClass.sm="content-title-sm" 
            ngClass.xs="content-title-xs">
            {{ equipment.title }}
        </h1>

        <h3 class="content-summary" 
            ngClass.sm="content-summary-sm" 
            ngClass.xs="content-summary-xs">
            {{ equipment.summary }}
        </h3>
    </ng-template>
    
    <ng-template #equipmentImage>
        <div>
            <div *ngIf="equipment.mainImage;">
                <img 
                    src="{{ equipment?.mainImage?.url }}" 
                    alt="{{ equipment?.mainImage?.description }}" 
                    width="100%" 
                    height="100%"/>
            </div>
        </div>
    </ng-template>

    <!-- Breadcrumbs -->
    <ng-container *ngTemplateOutlet="breadcrumbs"></ng-container>

    <div
        class="site-padding margin-bottom" 
        ngClass.sm="site-padding-sm margin-bottom" 
        ngClass.xs="site-padding-xs margin-bottom">

        <div>
            <div class="section" 
                fxLayout="column wrap"  
                fxLayout.sm="column wrap"
                fxLayout.xs="column wrap">

                <!-- Title and Summary -->
                <div 
                    class="equipment-info section">
                    <ng-container *ngTemplateOutlet="titleSummary"></ng-container>
                </div>

                <!-- Equipment Image -->
                <div 
                    *ngIf="equipment.mainImage"
                    class="equipment-image section">
                    <ng-container *ngTemplateOutlet="equipmentImage"></ng-container>
                </div>
            </div>

            <!-- Equipment Body -->
            <div class="section">
                <h4>Description<hr/></h4>
                <ngx-contentful-rich-text
                    class="section-2"
                    style="word-break:break-word;" 
                    [document]="equipment.bodyText.json"
                    [nodeRenderers]="nodeRenderers">
                </ngx-contentful-rich-text>
            </div>

            <!-- Owners and User Facing Support -->
            <div 
                class="equipment-owners"
                fxLayout="row wrap"
                fxLayout.xs="column wrap"
                fxLayoutGap="5%">
                <div *ngIf="equipment.relatedContactsCollection?.items.length > 0" fxFlex>
                    <ng-container *ngTemplateOutlet="relatedContacts; context: { hideImage: true }"></ng-container>
                </div>
                <div *ngIf="equipment.relatedOrgsCollection?.items.length > 0" fxFlex>
                    <ng-container *ngTemplateOutlet="relatedOrganisations; context: { hideImage: true }"></ng-container>
                </div>
                <div  *ngIf="equipment.relatedFacilityCollection?.items.length > 0" fxFlex>
                    <ng-container *ngTemplateOutlet="relatedFacilities; context: { hideImage: true }"></ng-container>
                </div>
            </div>

            <!-- Specifications Table -->
            <ng-container *ngTemplateOutlet="specificationsTable"></ng-container>

            <!-- Related Items -->
            <ng-container *ngTemplateOutlet="relatedItems; context: { hideImage: true }"></ng-container>

            <!-- Keywords -->
            <app-keywords [contentItem]="equipment.keywords"></app-keywords>

        </div>
    </div>
</div>
    