<!-- If we're displaying a collection of equipment -->
<app-collection-list 
    *ngIf="allEquipment$ | async as allEquipment" 
    [collection]="allEquipment">
</app-collection-list>


<!-- If we're displaying an individual equipment -->
<div 
    id="equipment-container"
    *ngIf="equipment$ | async as equipment">

    <!-- Templates -->
    <ng-template #dynamicBanner>
        <div 
            class="banner-container"
            [style]="equipment.banner ? 'background: url(' + equipment.banner.url + ') no-repeat' : equipment.viewType == 'View 2' ? 'display: none;' : ''">
        </div>  
    </ng-template>

    <ng-template #breadcrumbs>
        <div
            id="breadcrumbs"   
            *ngIf="!!parentSubHubs"
            ngClass.lt-md="breadcrumbs-mobile">
            <span 
                class="breadcrumb-subhub" 
                *ngFor="let subHub of parentSubHubs.slice().reverse()">
                <a [routerLink]="'/subhub/' + subHub.slug">
                    {{ subHub.title }}
                </a>
            </span>
            <span id="breadcrumb-current-page">
                {{ equipment.title }}
            </span>
        </div>
    </ng-template>

    <ng-template #specificationsTable>
        <div 
            class="specifications section">
            <h4>
                Specifications
            </h4>
            <table class="specifications-table">
                <tr>
                <th>Name</th>
                <th>Description</th>
                </tr>
                <tr *ngIf="equipment.manufacturer">
                    <td>Manufacturer</td>
                    <td [innerHTML]="equipment.manufacturer"></td>
                </tr>
                <tr *ngIf="equipment.year">
                    <td>Year</td>
                    <td [innerHTML]="equipment.year"></td>
                </tr>
                <tr *ngIf="equipment.model">
                    <td>Model</td>
                    <td [innerHTML]="equipment.model"></td>
                </tr>
                <tr *ngIf="equipment.location">
                    <td>Location</td>
                    <td [innerHTML]="equipment.location"></td>
                </tr>
            </table>
        </div>
    </ng-template>

    <ng-template #relatedItems>
        <div 
            *ngIf="equipment.relatedItemsCollection.items.length > 0" 
            id="you-might-be-interested-in">
            <h4>You might also be interested in</h4>
            <mat-nav-list 
                *ngFor="let relatedItem of equipment.relatedItemsCollection.items" 
                class="collection">
                    <a [routerLink]="'/' + relatedItem['__typename'].toLowerCase() + '/' + relatedItem['slug']">
                        <mat-card>
                            <span class="card-title">
                                {{ relatedItem['title'] }}
                            </span>
                            <br/>
                            <span class="card-summary">
                                {{ relatedItem['summary'] }}
                            </span>
                        </mat-card>
                    </a>
            </mat-nav-list>
        </div>
    </ng-template>

    <ng-template #relatedContacts>
        <div 
            *ngIf="equipment.relatedContactsCollection.items.length > 0">
            <h4>Contacts</h4>
            <mat-nav-list 
                *ngFor="let contact of equipment.relatedContactsCollection.items" 
                class="collection">
                    <a [routerLink]="">
                        <mat-card>
                            <span class="card-title">
                                {{ contact['name'] }}
                            </span> 
                            <br/>
                            <span class="card-summary">
                                {{ contact['jobTitle'] }}
                            </span>
                        </mat-card>
                    </a>
            </mat-nav-list>
        </div>
    </ng-template>

    <ng-template #titleSummary>
        <h1 
            class="content-title" 
            ngClass.lt-md="content-title-mobile" >
            {{ equipment.title }}
        </h1>

        <h3 class="content-summary" 
            ngClass.lt-md="content-summary-mobile">
            {{ equipment.summary }}
        </h3>
    </ng-template>

    <!-- Equipment Page Content -->
    
    <!-- Banner -->
    <ng-container *ngTemplateOutlet="dynamicBanner"></ng-container>

    <div
        class="site-padding top-padding margin-bottom"
        ngClass.lt-md="site-padding-mobile top-padding margin-bottom">

        <!-- Breadcrumbs -->
        <ng-container *ngTemplateOutlet="breadcrumbs"></ng-container>

        <div class="section" 
            fxLayout="row wrap"
            fxLayout.lt-md="column wrap"
            fxLayoutAlign="space-between center">

            <!-- Title and Summary -->
            <div 
                class="equipment-info">
                <ng-container *ngTemplateOutlet="titleSummary"></ng-container>
            </div>
            <hr/>
        </div>

        <!-- Equipment Body -->
        <div>
            <h4>Description<hr/></h4>
            <ngx-contentful-rich-text
                class="section-2 body-text"
                style="word-break:break-word;" 
                [document]="equipment.bodyText.json"
                [nodeRenderers]="nodeRenderers">
            </ngx-contentful-rich-text>
        </div>

        <!-- Contacts -->
        <div 
            *ngIf="equipment.relatedContactsCollection.items.length"
            class="equipment-owners"
            fxLayout="row wrap"
            fxLayout.xs="column wrap"
            fxLayoutGap="5%">
            <div>
                <ng-container *ngTemplateOutlet="relatedContacts"></ng-container>
            </div>
        </div>

        <!-- Specifications Table -->
        <ng-container *ngTemplateOutlet="specificationsTable"></ng-container>

        <!-- Related Items -->
        <ng-container *ngTemplateOutlet="relatedItems"></ng-container>
    </div>
</div>